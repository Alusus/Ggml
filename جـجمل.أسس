اشمل "Ggml"؛

عرف جـجمل: لقب Ggml؛
@دمج وحدة جـجمل {
    // ================ الثوابت ================

    @دمج عرف حـالة: {
        عرف _فشل_الحجز_: لقب Status.ALLOC_FAILED؛
        عرف _فشل_: لقب Status.FAILED؛
        عرف _نجاح_: لقب Status.SUCCESS؛
        عرف _إجهاض_: لقب Status.ABORTED؛
    }

    @دمج عرف نـوع: {
        عرف _ع32_: لقب Type.F32؛
        عرف _ع16_: لقب Type.F16؛
        عرف _ك4_0_: لقب Type.Q4_0؛
        عرف _ك4_1_: لقب Type.Q4_1؛
        عرف _ك5_0_: لقب Type.Q5_0؛
        عرف _ك5_1_: لقب Type.Q5_1؛
        عرف _ك8_0_: لقب Type.Q8_0؛
        عرف _ك8_1_: لقب Type.Q8_1؛
        عرف _ك2_ك_: لقب Type.Q2_K؛
        عرف _ك3_ك_: لقب Type.Q3_K؛
        عرف _ك4_ك_: لقب Type.Q4_K؛
        عرف _ك5_ك_: لقب Type.Q5_K؛
        عرف _ك6_ك_: لقب Type.Q6_K؛
        عرف _ص8_: لقب Type.I8؛
        عرف _ص16_: لقب Type.I16؛
        عرف _ص32_: لقب Type.I32؛
        عرف _ص64_: لقب Type.I64؛
        عرف _ع64_: لقب Type.F64؛
        عرف _عد16_: لقب Type.BF16؛
    }

    @دمج عرف نـوع_بنية: {
        عرف _مجهول_: لقب FType.UNKNOWN؛
        عرف _كله_ع32_: لقب FType.ALL_F32؛
        عرف _أغلبه_ع16_: لقب FType.MOSTLY_F16؛
        عرف _أغلبه_ك4_0_: لقب FType.MOSTLY_Q4_0؛
        عرف _أغلبه_ك4_1_: لقب FType.MOSTLY_Q4_1؛
        عرف _أغلبه_ك4_1_وبعض_ع16_: لقب FType.MOSTLY_Q4_1_SOME_F16؛
        عرف _أغلبه_ك8_0_: لقب FType.MOSTLY_Q8_0؛
        عرف _أغلبه_ك5_0_: لقب FType.MOSTLY_Q5_0؛
        عرف _أغلبه_ك5_1_: لقب FType.MOSTLY_Q5_1؛
        عرف _أغلبه_ك2_ك_: لقب FType.MOSTLY_Q2_K؛
        عرف _أغلبه_ك3_ك_: لقب FType.MOSTLY_Q3_K؛
        عرف _أغلبه_ك4_ك_: لقب FType.MOSTLY_Q4_K؛
        عرف _أغلبه_ك5_ك_: لقب FType.MOSTLY_Q5_K؛
        عرف _أغلبه_ك6_ك_: لقب FType.MOSTLY_Q6_K؛
        عرف _أغلبه_عد16_: لقب FType.MOSTLY_BF16؛
    }

    // ================ معاملات التهيئة ================

    عرف مـعطيات_تهيئة: لقب InitParams؛
    @دمج صنف مـعطيات_تهيئة {
        عرف حجم_الذاكرة: لقب memSize؛
        عرف صوان_الذاكرة: لقب memBuffer؛
        عرف بلا_حجز: لقب noAlloc؛
    }

    // ================ الدوال العامة ================

    عرف هيئ: لقب init؛
    عرف حرر: لقب free؛
    عرف هات_تكلفة_الموتر: لقب getTensorOverhead؛
    عرف هات_حجم_النوع: لقب getTypeSize؛
    عرف هات_حجم_الصف: لقب getRowSize؛
    عرف هات_تكلفة_البيان: لقب getGraphOverhead؛
    عرف حدد_دالة_الإجهاض: لقب setAbortCallback؛
    عرف أجهض: لقب abort؛
    عرف حول_نوع_بنية_إلى_نوع: لقب fTypeToType؛
    عرف حول_الحالة_لنص: لقب statusToString؛
    عرف حول_ع16_إلى_ع32: لقب fp16ToFp32؛
    عرف حول_ع32_إلى_ع16: لقب fp32ToFp16؛
    عرف حول_ع32_إلى_عد16: لقب fp32ToBf16؛
    عرف حول_عد16_إلى_ع32: لقب bf16ToFp32؛
    عرف ابن_توسيعا_أماميا: لقب buildForwardExpand؛
    عرف ابن_توسيعا_خلفيا: لقب buildBackwardExpand؛

    // ================ صنف المشغل (Backend) ================

    عرف مـشغل: لقب Backend؛
    @دمج صنف مـشغل {
        عرف هيئ_للمعالج: لقب cpuInit؛
        عرف هيئ_لفلكان: لقب vkInit؛
        عرف حرر: لقب free؛
        عرف هات_نوع_الصوان_المبدئي: لقب getDefaultBufferType؛
        عرف أللمعالج: لقب isCpu؛
        عرف ألفلكان: لقب isVk؛
        عرف حدد_عدد_المسالك_للمعالج: لقب cpuSetNThreads؛
        عرف شغل_البيان: لقب graphCompute؛
        عرف شغل_البيان_بالتوازي: لقب graphComputeAsync؛
    }

    // ================ صنف الموتر (Tensor) ================

    عرف مـوتر: لقب Tensor؛
    @دمج صنف مـوتر {
        عرف الاسم: لقب name؛
        عرف البيانات: لقب data؛
        عرف البيانات_ع32: لقب dataF32؛
        عرف حدد_كمدخل: لقب setInput؛
        عرف حدد_كمخرج: لقب setOutput؛
        عرف حدد_كمعامل: لقب setParam؛
        عرف حدد_كخسارة: لقب setLoss؛
        عرف عدد_العناصر: لقب nElements؛
        عرف عدد_الصفوف: لقب nRows؛
        عرف عدد_البايتات: لقب nBytes؛
        عرف عدد_البايتات_بمحاذاة: لقب nBytesPad؛
        عرف حدد_من_المشغل: لقب backendSet؛
        عرف هات_من_المشغل: لقب backendGet؛
    }

    // ================ صنف السياق (Context) ================

    عرف سـياق: لقب Context؛
    @دمج صنف سـياق {
        عرف أنشئ_موترا: لقب newTensor؛
        عرف كرر: لقب dup؛
        عرف أنشئ_بيانا: لقب newGraph؛
        عرف احجز_موترات_مشغل: لقب backendAllocTensors؛
        عرف اجمع: لقب add؛
        عرف اضرب: لقب mul؛
        عرف اطرح: لقب sub؛
        عرف قسم: لقب div؛
        عرف لوغاريتم: لقب log؛
        عرف مجموع: لقب sum؛
        عرف متوسط: لقب mean؛
        عرف أقصى_معامل: لقب argmax؛
        عرف معيار: لقب norm؛
        عرف معيار_المتوسط: لقب rmsNorm؛
        عرف اضرب_مصفوفات: لقب mulMat؛
        عرف حجم: لقب scale؛
        عرف حدد: لقب set؛
        عرف انسخ_إلى: لقب cpy؛
        عرف استمر: لقب cont؛
        عرف أعد_التشكيل: لقب reshape؛
        عرف اعرض: لقب view؛
        عرف بدل: لقب permute؛
        عرف منقولة: لقب transpose؛
        عرف هات_صفوفا: لقب getRows؛
        عرف حدد_صفوفا: لقب setRows؛
        عرف قطري: لقب diag؛
        عرف قناع_قطري_لا_نهائي: لقب diagMaskInf؛
        عرف قناع_قطري_لا_نهائي_موضعيا: لقب diagMaskInfInplace؛
        عرف قناع_قطري_صفري: لقب diagMaskZero؛
        عرف قناع_قطري_صفري_موضعيا: لقب diagMaskZeroInplace؛
        عرف أسية_مطبعة: لقب softMax؛
        عرف تضمين_موضعي_دوار: لقب rope؛
        عرف حشو: لقب pad؛
        عرف لف: لقب roll؛
        عرف شغل_البيان: لقب graphCompute؛
    }

    // ================ صنف البيان (CGraph) ================

    عرف بـيان: لقب CGraph؛
    @دمج صنف بـيان {
        عرف خطط: لقب plan؛
        عرف شغل: لقب compute؛
        عرف أعد_الضبط: لقب reset؛
        عرف اطبع: لقب print؛
    }

    // ================ صنف الخطة (CPlan) ================

    عرف خـطة: لقب CPlan؛
    @دمج صنف خـطة {
        عرف حجم_العمل: لقب workSize؛
        عرف بيانات_العمل: لقب workData؛
        عرف عدد_المسالك: لقب nThreads؛
        عرف مجمع_المسالك: لقب threadPool؛
        عرف دالة_الإجهاض: لقب abortCallback؛
        عرف بيانات_دالة_الإجهاض: لقب abortCallbackData؛
    }

    // ================ صنف صوان المشغل (BackendBuffer) ================

    عرف صـوان_مشغل: لقب BackendBuffer؛
    @دمج صنف صـوان_مشغل {
        عرف حرر: لقب free؛
    }

    عرف نـوع_صوان_مشغل: لقب BackendBufferType؛

    // ================ صنف مخصص البيان (Gallocr) ================

    عرف حـاجز_بيان: لقب Gallocr؛
    @دمج صنف حـاجز_بيان {
        عرف أنشئ: لقب new؛
        عرف حرر: لقب free؛
        عرف احجز_بيانا: لقب allocGraph؛
    }

    // ================ صنف تجمع المسالك (ThreadPool) ================

    عرف مـجمع_مسالك: لقب ThreadPool؛
    @دمج صنف مـجمع_مسالك {
        @دمج عرف أولـوية_جدولة: {
            عرف _منخفضة_: لقب SchedPriority.LOW؛
            عرف _عادية_: لقب SchedPriority.NORMAL؛
            عرف _متوسطة_: لقب SchedPriority.MEDIUM؛
            عرف _عالية_: لقب SchedPriority.HIGH؛
            عرف _وقت_حقيقي_: لقب SchedPriority.REALTIME؛
        }

        عرف مـعطيات: لقب Params؛
        @دمج صنف مـعطيات {
            عرف قناع_المعالجات: لقب cpuMask؛
            عرف عدد_المسالك: لقب nThreads؛
            عرف الأولوية: لقب prio؛
            عرف الاستقصاء: لقب poll؛
            عرف معالج_صارم: لقب strictCpu؛
            عرف متوقف: لقب paused؛
            عرف هيئ: لقب init؛
            عرف هات_المبدئية: لقب getDefault؛
            عرف طابق: لقب match؛
        }

        عرف أنشئ: لقب new؛
        عرف حرر: لقب free؛
        عرف عدد_المسالك: لقب nThreads؛
        عرف أوقف: لقب pause؛
        عرف استأنف: لقب resume؛
    }
}
